/*
 * cacl.c
 *
 *  Created on: 2019年5月20日
 *      Author: fenglong
 */
#include "System.h"
#include "calculate.h"




const  u16 TEMP_AD_TABLE [142] =
{
    8017,7984,7947,7912,7874,7838,7791,7757,7709,7668,//-30
    7622,7572,7516,7471,7404,7349,7309,7245,7174,7123,//-20
    7068,7008,6944,6875,6812,6740,6670,6601,6521,6451,//-10
    6377,6307,6237,6167,6097,6000,5885,5775,5675,5575,//0
    5490,5406,5321,5236,5152,5067,4982,4898,4813,4729,//10
    4647,4566,4484,4403,4322,4240,4159,4077,3996,3915,//20
    3841,3766,3692,3618,3544,3470,3396,3322,3248,3174,//30
    3110,3046,2982,2919,2855,2791,2728,2664,2600,2537,//40
    2484,2432,2379,2327,2275,2222,2170,2117,2065,2013,//50
    1970,1928,1886,1844,1802,1760,1718,1676,1634,1592,//60
    1558,1525,1492,1459,1426,1393,1360,1327,1294,1261,//70
    1234,1208,1182,1156,1130,1104,1078,1052,1026,1000,//80
    980,960,940,920,900,880,860,840,820,799,
    784,769,753,738,722,707,691,676,660,645,
    630,610,
};


const  s8 TEMP_TABLE[142] =
{
    -30,-29,-28,-27,-26,-25,-24,-23,-22,-21,
    -20,-19,-18,-17,-16,-15,-14,-13,-12,-11,
    -10,-9,-8,-7,-6,-5,-4,-3,-2,-1,
    0,1,2,3,4,5,6,7,8,9,
    10,11,12,13,14,15,16,17,18,19,
    20,21,22,23,24,25,26,27,28,29,
    30,31,32,33,34,35,36,37,38,39,
    40,41,42,43,44,45,46,47,48,49,
    50,51,52,53,54,55,56,57,58,59,
    60,61,62,63,64,65,66,67,68,69,
    70,71,72,73,74,75,76,77,78,79,
    80,81,82,83,84,85,86,87,88,89,
    90,91,92,93,94,95,96,97,98,99,
    100,101,102,103,104,105,106,107,108,109,
    110,111,
};//  可以优化






//NTC温度查表
s8 vAPI_IndexNtcTemp(u16 temp_ad_val)               //fenglong 20190605
{
    s8 temp_val;
    u8 low =0;
    u16 table_val;
    table_val = temp_ad_val;
    while (low < 141)
    {
        if ((table_val > TEMP_AD_TABLE[low])||(table_val == TEMP_AD_TABLE[low]))
        {
                temp_val = TEMP_TABLE[low];
                break;
        }
        else
        {
            low++;
        }

    }
    if(low == 141)
    {
            temp_val = TEMP_TABLE[140];
    }
    return temp_val;

}










//
//const UINT16 Temperature[] =
//{   32900, 31067, 29235, 27403, 25571, 23739, 22455,
//    21171, 19887, 18603, 17319, 16410, 15502, 14594,
//    13686, 12777, 12128, 11479, 10831, 10182, 9533,
//    9061, 8589, 8118, 7646, 7175, 6831, 6487, 6144,
//    5800, 5456, 5201, 4946, 4691, 4436, 4181, 3992,
//    3802, 3612, 3423, 3233, 3090, 2948, 2805, 2662,
//    2519, 2411, 2303, 2195, 2087, 1979, 1896, 1813,
//    1730, 1648, 1565, 1501, 1438, 1374, 1310, 1247,
//    1197, 1148, 1099, 1049, 1000, 961, 923, 884, 846,
//    807, 777, 747, 716, 686, 656, 632, 608, 584, 560,
//    536, 517, 497, 478, 459, 440, 425, 409, 394, 379,
//    364, 351, 339, 327, 314, 302, 292, 282, 272, 262,
//    252, 244, 236, 228, 220, 212, 205, 198, 191, 185,
//    178, 173, 167, 162, 156, 151, 146, 142, 137, 133,
//    128, 125, 121, 117, 113, 110, 107, 103, 100, 97,
//    94, 91, 89, 86, 84, 81, 79, 77, 74, 72, 70, 68,
//    66, 65, 63, 61, 59, 58, 56, 55, 53, 52, 50, 49,
//    48, 46, 45, 44, 43, 42, 41, 40, 39, 38, 37, 36
//};
//
//
//UINT8 TSDataCompute(UINT8 HiData, UINT8 LoData)
//{
//    union _WORD X1;
////    union _LONG Buff_0;
//    UINT8 Buff_0;
//    UINT32 Buff_1;
//    UINT8 i;
//
//    X1.Byte.HI = HiData;
//    X1.Byte.LO = LoData;
//
//    Buff_1 = X1.Word;
//    Buff_1 = (Buff_1 * BQ76930_TS_Const) / 1000;
//    Buff_1 = ((10000 * Buff_1) / (3300 - Buff_1)) / 10;
//    //  Buff_0.Long = Buff_1;
//
//    for (i = 0; i < 125; i++)
//    {
//        if (Buff_1 >= Temperature[i])
//        {
//            Buff_0 = i;
//            break;
//        }
//
//    }
//
//    _nop ();
//    return Buff_0;
//}
